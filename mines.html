<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sim of World - Eyalet Madenleri</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #0d0d0d;
            --bg-header: #0a0a0a;
            --accent-cyan: #00e5ff;
            --accent-green: #2ecc71;
            --accent-gold: #ffd700;
            --accent-red: #e74c3c;
            --accent-gray: #a0a0a0;
            --text-white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: #000;
            font-family: 'Rajdhani', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-white);
        }

        .game-container {
            width: 100%;
            max-width: 450px;
            background-color: var(--bg-dark);
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            background-image: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.9)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/2000px-World_map_blank_without_borders.svg.png');
            background-size: cover;
            background-position: center;
        }

        /* MAIN CONTENT */
        main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            padding-bottom: 80px; /* Bottom nav için boşluk */
        }

        .page-header { text-align: center; margin-bottom: 25px; animation: fadeInDown 0.6s ease; }
        .page-title { font-size: 1.5rem; font-weight: 700; letter-spacing: 1px; margin-bottom: 5px; text-transform: uppercase; }
        .page-subtitle { font-size: 0.9rem; color: var(--accent-gray); }

        /* MADEN LİSTESİ */
        .mine-list { display: flex; flex-direction: column; gap: 15px; }

        .mine-card {
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            animation: fadeSlideUp 0.6s ease backwards;
            overflow: hidden;
        }
        .mine-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        /* Maden Başlık Alanı */
        .mine-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .mine-icon { width: 32px; height: 32px; object-fit: contain; filter: drop-shadow(0 0 2px rgba(255,255,255,0.2)); }
        .mine-title { font-size: 1.2rem; font-weight: 700; text-transform: uppercase; }
        
        /* Maden Bilgi */
        .mine-info { font-size: 0.85rem; color: #ccc; margin-bottom: 15px; }

        /* İlerleme Çubuğu Alanı */
        .status-label { font-size: 0.75rem; font-weight: bold; margin-bottom: 5px; display: block; }
        .progress-container {
            height: 25px;
            background: #222;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            border: 1px solid #444;
        }
        .progress-bar {
            height: 100%;
            width: 100%; /* Varsayılan dolu */
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-weight: bold;
            font-size: 0.9rem;
            color: #000;
            text-shadow: 0 0 2px rgba(255,255,255,0.5);
            transition: width 0.5s ease;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        /* MADEN RENK VARYASYONLARI */
        /* Altın Madeni */
        .mine-gold { border-top: 3px solid var(--accent-gold); }
        .mine-gold .mine-icon, .mine-gold .mine-title { color: var(--accent-gold); }
        .mine-gold .status-label { color: var(--accent-gold); }
        .mine-gold .progress-bar { background: linear-gradient(90deg, var(--accent-gold), #f1c40f); box-shadow: 0 0 15px var(--accent-gold); }

        /* Orman */
        .mine-forest { border-top: 3px solid var(--accent-green); }
        .mine-forest .mine-icon, .mine-forest .mine-title { color: var(--accent-green); }
        .mine-forest .status-label { color: var(--accent-green); }
        .mine-forest .progress-bar { background: linear-gradient(90deg, var(--accent-green), #27ae60); box-shadow: 0 0 15px var(--accent-green); }

        /* Taş Madeni */
        .mine-stone { border-top: 3px solid var(--accent-cyan); }
        .mine-stone .mine-icon, .mine-stone .mine-title { color: var(--accent-cyan); }
        .mine-stone .status-label { color: var(--accent-cyan); }
        .mine-stone .progress-bar { background: linear-gradient(90deg, var(--accent-cyan), #3498db); box-shadow: 0 0 15px var(--accent-cyan); }

        /* Kömür Madeni */
        .mine-coal { border-top: 3px solid var(--accent-red); }
        .mine-coal .mine-icon, .mine-coal .mine-title { color: var(--accent-red); }
        .mine-coal .status-label { color: var(--accent-red); }
        .mine-coal .progress-bar { background: linear-gradient(90deg, var(--accent-red), #c0392b); box-shadow: 0 0 15px var(--accent-red); }

        /* BOTTOM NAVIGATION */
        .bottom-nav {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: #0a0a0a;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 10;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--accent-gray);
            font-size: 0.75rem;
            cursor: pointer;
            transition: color 0.3s;
            text-decoration: none;
        }
        .nav-item i { font-size: 1.4rem; margin-bottom: 3px; }
        .nav-item.active { color: var(--accent-cyan); }
        .nav-item:hover { color: var(--accent-cyan); }

        /* Animasyonlar */
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeSlideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }

        /* MODAL STYLES */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 2000; animation: fadeIn 0.2s; }
        .modal-card { background: #161616; padding: 25px; border-radius: 12px; border: 1px solid #333; text-align: center; width: 90%; max-width: 350px; box-shadow: 0 0 40px rgba(0,0,0,0.8); transform: scale(0.95); animation: popIn 0.3s forwards; }
        .modal-card h3 { color: var(--text-white); margin-bottom: 10px; font-size: 1.4rem; }
        .modal-desc { color: #aaa; font-size: 0.9rem; margin-bottom: 20px; }
        .cost-display { font-size: 1.8rem; color: var(--accent-green); font-weight: 700; margin: 15px 0 25px; text-shadow: 0 0 10px rgba(46, 204, 113, 0.3); }
        .modal-actions { display: flex; gap: 10px; justify-content: center; }
        .btn-modal { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; font-family: 'Rajdhani', sans-serif; font-size: 1rem; transition: 0.2s; }
        .btn-cancel { background: #2a2a2a; color: #fff; }
        .btn-cancel:hover { background: #3a3a3a; }
        .btn-confirm { background: var(--accent-green); color: #000; }
        .btn-confirm:hover { background: #27ae60; box-shadow: 0 0 15px rgba(46, 204, 113, 0.4); }

        /* LOCKED STATE */
        .mine-card.locked { filter: grayscale(1); opacity: 0.7; border-style: dashed; }
        .mine-card.locked:hover { transform: none; filter: grayscale(0); opacity: 1; border-style: solid; border-color: var(--accent-gold); }
        .locked-badge { 
            display: block; 
            background: rgba(231, 76, 60, 0.15); 
            color: var(--accent-red); 
            border: 1px solid var(--accent-red); 
            text-align: center; 
            padding: 8px; 
            border-radius: 4px; 
            font-weight: 700; 
            margin-top: 10px;
            letter-spacing: 1px;
        }
        .buy-hint { font-size: 0.8rem; color: var(--accent-gold); margin-top: 5px; display: block; text-align: center; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    </style>
</head>
<body>

    <div class="game-container">
        <!-- Header removed, injected by header-manager.js -->

        <main>
            <div class="page-header">
                <h1 class="page-title">EYALET MADENLERİ</h1>
                <p class="page-subtitle">XP ve kaynak kazanmak için madenleri toplayın.</p>
            </div>

            <div class="mine-list" id="mineListContainer">
                <!-- JS ile doldurulacak -->
            </div>
        </main>

        <!-- BUY MODAL -->
        <div id="buyModal" class="modal-overlay">
            <div class="modal-card">
                <h3 id="modalTitle">MADEN LİSANSI</h3>
                <p class="modal-desc">Bu madeni işletebilmek için işletme lisansı satın almalısınız.</p>
                <div class="cost-display" id="modalCost">0 ₺</div>
                <div class="modal-actions">
                    <button class="btn-modal btn-cancel" onclick="closeModal()">VAZGEÇ</button>
                    <button class="btn-modal btn-confirm" onclick="confirmPurchase()">SATIN AL</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // MADEN VERİLERİ
        const minesData = [
            { id: 'wood', name: 'Odun Kampı', icon: 'https://cdn-icons-png.flaticon.com/512/2965/2965567.png', desc: 'Ormanlardan kaliteli kereste topla.', colorClass: 'mine-forest', percent: 95, cost: 1000 },
            { id: 'stone', name: 'Taş Ocağı', icon: 'https://cdn-icons-png.flaticon.com/512/6660/6660085.png', desc: 'İnşaat için temel yapı malzemesi.', colorClass: 'mine-stone', percent: 88, cost: 2000 },
            { id: 'iron', name: 'Demir Madeni', icon: 'https://cdn-icons-png.flaticon.com/512/7396/7396136.png', desc: 'Sanayi üretimi için demir cevheri.', colorClass: 'mine-stone', percent: 70, cost: 5000 },
            { id: 'coal', name: 'Kömür Madeni', icon: 'https://cdn-icons-png.flaticon.com/512/2163/2163291.png', desc: 'Enerji üretimi için fosil yakıt.', colorClass: 'mine-coal', percent: 65, cost: 8000 },
            { id: 'oil', name: 'Petrol Kuyusu', icon: 'https://cdn-icons-png.flaticon.com/512/2933/2933900.png', desc: 'Siyah altın, enerji ve yakıt kaynağı.', colorClass: 'mine-coal', percent: 50, cost: 15000 },
            { id: 'diamond', name: 'Elmas Madeni', icon: 'https://cdn-icons-png.flaticon.com/512/4248/4248369.png', desc: 'Nadir bulunan değerli kristaller.', colorClass: 'mine-stone', percent: 15, cost: 50000 },
            { id: 'uranium', name: 'Uranyum Madeni', icon: 'https://cdn-icons-png.flaticon.com/512/3055/3055350.png', desc: 'Nükleer enerji hammaddesi.', colorClass: 'mine-forest', percent: 30, cost: 30000 },
            { id: 'copper', name: 'Bakır Madeni', icon: 'https://cdn-icons-png.flaticon.com/512/3655/3655599.png', desc: 'Elektronik sanayi için iletken metal.', colorClass: 'mine-coal', percent: 60, cost: 10000 },
            { id: 'gold', name: 'Altın Madeni', icon: 'https://cdn-icons-png.flaticon.com/512/2535/2535561.png', desc: 'Ekonominin temeli, değerli metal.', colorClass: 'mine-gold', percent: 40, cost: 25000 }
        ];

        let selectedMineId = null;
        let userLicenses = {};

        async function initMines() {
            const container = document.getElementById('mineListContainer');
            container.innerHTML = '<div style="text-align:center; padding:20px;">Yükleniyor...</div>';
            
            const user = JSON.parse(localStorage.getItem('simWorldUser'));
            if (!user) return;

            try {
                // API'den lisansları çek
                const response = await fetch(`/api/licenses/${user.id}`);
                userLicenses = await response.json();
            } catch (e) {
                console.error(e);
            }

            container.innerHTML = '';

            minesData.forEach(mine => {
                // API'den gelen veriye göre kontrol (Level > 0 ise lisans var)
                const level = userLicenses[mine.id] || 0;
                const hasLicense = level > 0;
                
                const card = document.createElement('div');
                
                // Temel Sınıflar
                card.className = `mine-card ${mine.colorClass}`;
                if (!hasLicense) card.classList.add('locked');

                // İçerik
                let statusHTML = '';
                if (hasLicense) {
                    statusHTML = `
                        <span class="status-label">REZERV DURUMU (Lv. ${level})</span>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: ${mine.percent}%;">${mine.percent}%</div>
                        </div>`;
                    card.onclick = () => window.location.href = `mines-detail.html?res=${mine.id}`;
                } else {
                    statusHTML = `
                        <div class="locked-badge">LİSANS GEREKLİ</div>
                        <span class="buy-hint">LİSANS ALMAK İÇİN TIKLA</span>
                    `;
                    // Kilitliyse Lisans Sayfasına Yönlendir
                    card.onclick = () => window.location.href = 'licence.html';
                }

                card.innerHTML = `
                    <div class="mine-header">
                        <img src="${mine.icon}" class="mine-icon" alt="${mine.name}">
                        <div class="mine-title">${mine.name}</div>
                    </div>
                    <div class="mine-info">${mine.desc}</div>
                    ${statusHTML}
                `;

                container.appendChild(card);
            });
        }

        // Modal fonksiyonları kaldırıldı, artık licence.html kullanılıyor.
        function formatMoney(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        window.addEventListener('load', initMines);
    </script>
    <script src="loader-manager.js"></script>
    <script src="header-manager.js"></script>
    <script src="menu-manager.js"></script>
</body>
</html>